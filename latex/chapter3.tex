\chapter{Architecture}
\label{chapter:architecture}

In this chapter there will be provided a solution to improve the efficiency and usability of a building by using automation mechanisms, enhancing the intelligence of the building. Taking in account the \ac{iot} principles, this system will be capable of real-time processing of large data streams, analyse and correlate events, and being able to react and adapt to emergency states and guarantee the minimum functionality, always. This solution is intended to integrate the SmartLightinhg project and will be addressed in this chapter.

This chapter will begin with a brief description, in section \ref{Architecture:slproject}, of SmartLighting project and its intentions of developing a smart environment of automation and control in IT2 building. Later, in section \ref{Architecture:Stakeholders}, there will be presented a description of the stakeholders and their roles in this project.

In order to ensure that all system necessities are addressed and taken into account, in section \ref{Architecture:Requirements} will be done a survey of necessary capabilities and  requirements to satisfy its stakeholders, following by the mapping of user cases in section \ref{Architecture:usecases}, and finally, in section \ref{Architecture:Architecture}, a presentation and evaluation of the system architecture, and its components interactions. 


\newpage


\section{SmartLighting Project}
\label{Architecture:slproject}

The SmartLighting project aims to create a smart environment in IT2 building in order to automate the lighting and HVAC infrastructure. IT2 building have been running with CFL luminaries, which, are often not only, inefficient and hazardous for the environment, but also, in most cases, unable to be dimmed. 

This project intend to remove all this CFL luminaries by LED luminaries, that can resolve all the issues stated before and also are able, combining with sensors, to collect data from the environment such as luminance, temperature, humidity, motion and others. All of the collected data will be used to act in real-time to the changes in the sensors readings. 

Such system needs to be backed up by an intelligent management platform in order to act based on a set of rules and input streams of sensors values. Moreover, there will be mechanisms to correlate events and determine patterns that will enable a more immediate reaction. As an example, if a user has the habit of turn on the AC everyday in the morning, the system will be able to learn and automatically do that action soon as the user arrives in the building. 

Also, the system can use external sources such as meteorological forecast to take preventively actions, such as increase the dimming levels of luminaries and the building temperature in cold rainy days.

Additionally, the users will be able to set their own rules to enhance the comfort in its office. This can be done either by using a mobile application or a web interface. Also, this user platforms can enable the use of notifications providing ways to alert the building occupants of important events. For instance, users can be informed about future meetings, the presence of another occupant in the building, and more.

Finally, an important feature for this project is the fail safe mechanisms to ensure that all the basic automation needed for the building well functioning, such as the trigger of a motion sensor lighting up the corresponding luminaries, work even if in situations of failure in core elements of the architecture or network communication problems. This can be achieved by giving gateways, the component that communicate directly with the sensors and actuators, lightweight processing mechanisms to ensure the basic functionalities described before. This will be the main focus of the presented dissertation.


\section{Stakeholders}
\label{Architecture:Stakeholders}

The success of a project depends directly in the people involved, either by developing its features or simply by consuming them in its final form. A correct identification of the stakeholders, their motivations and expectations, pay a important role in the success of any project. 

In SmartLighting project, 4 stakeholders were identified, namely:

\begin{itemize}
	\item Building occupants
	\item Building owners
	\item Building managers
	\item Developers team
\end{itemize}


The primary stakeholders in this project, are the IT2 building occupants and owners. While occupants will take direct advantage from the implemented features due to the enhance in comfort and usability of the building, owners gains will be economic as far as the building energy consumption and maintenance costs will be reduced.

As for building managers, the benefits are from easier interaction and configuration of the whole system, that allow a more precise aware of every node status, to a notification system for quicker reaction to system failures, or even to prevent such ones, and act before they happen.

Lastly, the developers team take a huge benefit in the success of the project since they are interested and devoted to create the best product possible that fulfils all the other stakeholders expectations.


\section{Use Cases}
\label{Architecture:usecases}
In order to a better understanding of the system features, in this section will be presented some examples of use cases. This approach will be divided in two subsections, namely, user interactions, in section \ref{Use:users} , where will be addressed the direct interaction between real actors and system features, and, in section \ref{Use:system}, system interactions, where will be addressed all the interactions between internal components of the system.

\subsection{User Interaction}
\label{Use:users}

This section will focus on the direct interactions between the two main users of the IT2 building and this system. Firstly will be addressed the use cases of the normal building occupants and later, the use cases of the building manger, responsible for the management and configuration of the system.

\subsubsection{Building Occupant}

The building occupants will be the principal users that will interact with the system. This interaction can be achieved by using either a mobile application or a web interface. The use cases addressed bellow combine the most common and frequent operations:

\begin{Paragraph}{Login/Logout}

This use cases are intended to enable the access to user oriented features. The building occupants can login in the platform, either using the mobile application or the web interface, to access his preferences and personal environment control features. 

\end{Paragraph}

\begin{Paragraph}{Request changes in devices state}

The building occupant can request a change in the state of a device, that can be accepted or denied by the system depending on the access rights of the user. For instance, an occupant can request a change in near by devices like  air conditioners, lights, and others.

\end{Paragraph}

\begin{Paragraph}{List nearby devices}

This use case allows users to request the list of nearby devices, based on its location, allowing to access or request changes to devices in the same room as the occupant, giving that these are the most likely to be needed access.

\end{Paragraph}

\begin{Paragraph}{Configure device preferences}

The user can create or edit device pre-sets, allowing that the selected values are applied automatically to the device in future uses. For instance, the air conditioner in a user office can be pre-set to 21ÂºC so that when this device is turned on, that value is automatically set. This changes would also depend with the user access rights.

\end{Paragraph}

\begin{Paragraph}{Configure user rules}
	
This use case allow the building occupants to create rules that preform a set of actions automatically, giving the right conditions. For instance the user could create a rule to automatically turn the air conditioner on if the temperature in his office exceed a giving value.
	
\end{Paragraph}

\subsubsection{Building Manager}

\begin{Paragraph}{Create building structure}
	
The manager can create the representation of the building in the structure management platform. This allow the creation of a virtual portrayal of the floors, rooms and areas of the building.
	
\end{Paragraph}

\begin{Paragraph}{Distribute devices}

This use case permit that connected devices can be distributed through the areas and rooms of the building virtual representation.
	
\end{Paragraph}

\begin{Paragraph}{Configure global rules}

The building manager has the ability to add, delete, enable or disable rules for the whole building. These core rules' main purpose are the building's efficiency increase, for instance instead of leaving the corridors lights always on, a rule can be created to turn them off when there's no one walking by. There is also a mechanism to test the rule before the deployment.

\end{Paragraph}


\subsection{System Interaction}
\label{Use:system}
TODO
\subsubsection{Device}
TODO
\subsubsection{Gateway}
TODO
\subsubsection{CEP Engine}
TODO
\subsubsection{Management System}
TODO

\section{Requirements}
\label{Architecture:Requirements}

\section{System Architecture}
\label{Architecture:Architecture}



